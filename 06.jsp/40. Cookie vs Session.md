# 40. Cookie vs Session

- **Cookie**ëŠ” ë°ì´í„°ë¥¼ **client**ì— ì €ì¥
- **Session**ì€ **ì„œë²„**ì— ì €ì¥ 
  - Sessionì´ Cookieë³´ë‹¤ ë³´ì•ˆì€ ìš°ìˆ˜í•˜ë‚˜ ì„œë²„ì— ë¶€ë‹´ì„ ì¤Œ
  - ë¡œê·¸ì¸ ê°™ì€ **ì¤‘ìš”í•œ ì‘ì—…ì—ë§Œ ì‚¬ìš©** ê¶Œì¥



- ê¸°íƒ€ ë‹¤ë¥¸ ì‘ì—…ì€ Cookie ì‚¬ìš© ê¶Œì¥
  - *ì˜ˆ) ê³µì§€ì‚¬í•­ í•˜ë£¨ë™ì•ˆ ì•ˆëœ¨ê²Œ í•˜ê¸°*



> - cookieì½”ë“œëŠ” jsp/servlet ìœ¼ë¡œ ì‘ì„±í•˜ë‚˜ javascript ë˜ëŠ” jQueryë¡œ ì‘ì„±
> - jQueryì— `cookie plugin` ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” í¸ë¦¬
>   - ì˜ˆ) `Cookies.set('username', 'haein');`
>     - expireì´ ì—†ëŠ” ì¿ í‚¤ë¼ì„œ ë¸Œë¼ìš°ì €ê°€ êº¼ì§€ë©´ ê°™ì´ ì‚¬ë¼ì§
>     - expireë„ ê°™ì´ ëª…ì‹œí•´ì¤˜ì•¼ ë§Œë£Œê¸°ê°„ì´ ì •í•´ì§



- notice.jsp

```java
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%
    boolean showNotice = true; // ê³µì§€ì‚¬í•­ ì¶œë ¥ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸° ìœ„í•œ flag

    // ì¿ í‚¤ ì²´í¬
    Cookie[] cookies = request.getCookies();
    if (cookies != null) {
        for (Cookie cookie : cookies) { // ì›í•˜ëŠ” ì¿ í‚¤ë¥¼ í•˜ë‚˜ë§Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ê²Œ ì•„ë‹˜, ë°˜ë³µë¬¸ì„ í†µí•´ì„œ ì›í•˜ëŠ” ì¿ í‚¤ë¥¼ êµ¬í•´ì•¼ í•¨
            if ("noticeHidden".equals(cookie.getName())) {
                showNotice = false;
                break;
            }
        }
    }
%>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ê³µì§€ì‚¬í•­</title>
    <script>
        function closeNotice() {
            if (document.getElementById("hideToday").checked) {
                // ì¿ í‚¤ ìƒì„± (1ì¼ ìœ íš¨)
                let date = new Date();
                date.setTime(date.getTime() + (24 * 60 * 60 * 1000)); // 1ì¼. ì¿ í‚¤ë³´ì¡´ì‹œê°„
                // ì¿ í‚¤ëª…ì€ noticeHidden. trueê°’ì„ ì €ì¥. ì ìš©ë˜ëŠ” ê²½ë¡œëŠ” '/'. root directoryì´í•˜ ëª¨ë“ ê²½ë¡œ
                document.cookie = "noticeHidden=true; path=/; expires=" + date.toUTCString(); // expires íŒŒê¸° ë‚ ì§œ (UTCë‚ ì§œë³€í™˜)
            }

            // ê³µì§€ì‚¬í•­ ì˜ì—­ ìˆ¨ê¹€
            document.getElementById("noticeBox").style.display = "none";
        }
    </script>
</head>
<body>

<% if (showNotice) { %>
    <div id="noticeBox" style="background-color: #fffae6; padding: 15px; border: 1px solid #ccc; margin-bottom: 20px;">
        <strong>ğŸ“¢ ê³µì§€ì‚¬í•­:</strong> ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
        <input type="checkbox" id="hideToday"> ì˜¤ëŠ˜ í•˜ë£¨ ì´ ì°½ì„ ë‹¤ì‹œ ë³´ì§€ ì•ŠìŒ
        <button onclick="closeNotice()">ë‹«ê¸°</button>
    </div>
<% } %>

<h2>ë©”ì¸ ì½˜í…ì¸ </h2>
<p>ì—¬ê¸° ë©”ì¸ í˜ì´ì§€ ë‚´ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>

</body>
</html>
```



**í•˜ì§€ë§Œ jspì— javaì½”ë“œê°€ ìˆëŠ” ê²ƒì€ MVC ë²•ì¹™ì— ìœ„ë°° ëœë‹¤.**

- Notice.java

```java
import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class Notice
 */
@WebServlet("/notice.do")
public class Notice extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public Notice() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		boolean showNotice = true; // ê³µì§€ì‚¬í•­ ì¶œë ¥ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸° ìœ„í•œ flag

	    // ì¿ í‚¤ ì²´í¬
	    Cookie[] cookies = request.getCookies();
	    if (cookies != null) {
	        for (Cookie cookie : cookies) {
	            if ("noticeHidden".equals(cookie.getName())) {
	                showNotice = false;
	                break;
	            }
	        }
	    }
		
		RequestDispatcher dispatcher=request.getRequestDispatcher("notice.jsp");
		request.setAttribute("showNotice", showNotice);
		dispatcher.forward(request, response);
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		  Cookie cookie = new Cookie("noticeHidden", "true"); // ì¿ í‚¤ ì´ë¦„ ì§€ì •í•˜ì—¬ ìƒì„±( key, value ê°œë…)
		  cookie.setMaxAge(60*60*24); //ì¿ í‚¤ ìœ íš¨ ê¸°ê°„: í•˜ë£¨ë¡œ ì„¤ì •(60ì´ˆ * 60ë¶„ * 24ì‹œê°„)
		  cookie.setPath("/"); //ëª¨ë“  ê²½ë¡œì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
		  response.addCookie(cookie); //responseì— Cookie ì¶”ê°€
	}
}
```

- notice.jsp

  ```java
  <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
  <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
  <%
     /*  boolean showNotice = true; // ê³µì§€ì‚¬í•­ ì¶œë ¥ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸° ìœ„í•œ flag

      // ì¿ í‚¤ ì²´í¬
      Cookie[] cookies = request.getCookies();
      if (cookies != null) {
          for (Cookie cookie : cookies) {
              if ("noticeHidden".equals(cookie.getName())) {
                  showNotice = false;
                  break;
              }
          }
      } */
  %>

  <!DOCTYPE html>
  <html>
  <head>
      <meta charset="UTF-8">
      <title>ê³µì§€ì‚¬í•­</title>
      <script>
  /*
  		function closeNotice() {
              if (document.getElementById("hideToday").checked) {
                  // ì¿ í‚¤ ìƒì„± (1ì¼ ìœ íš¨)
                  let date = new Date();
                  date.setTime(date.getTime() + (24 * 60 * 60 * 1000)); // 1ì¼. ì¿ í‚¤ë³´ì¡´ê¸°ê°„
                  // ì¿ í‚¤ëª…ì€ noticeHidden. trueê°’ì„ ì €ì¥. ì ìš©ë˜ëŠ” ê²½ë¡œëŠ” '/'. root directoryì´í•˜ ëª¨ë“  ê²½ë¡œ.
                  document.cookie = "noticeHidden=true; path=/; expires=" + date.toUTCString();
              }

              // ê³µì§€ì‚¬í•­ ì˜ì—­ ìˆ¨ê¹€
              document.getElementById("noticeBox").style.display = "none";
          } 
  */
          
          function closeNotice() {
              if (document.getElementById("hideToday").checked) {
              	
              	//Ajaxì²˜ë¦¬
              	fetch("notice.do", {
              		  method: "POST"            		 
              		})
              		.then((result) => console.log(result));
              }

              // ê³µì§€ì‚¬í•­ ì˜ì—­ ìˆ¨ê¹€
              document.getElementById("noticeBox").style.display = "none";
          }
      </script>
  </head>
  <body>

  <%-- 

  <% if (showNotice) { %>
      <div id="noticeBox" style="background-color: #fffae6; padding: 15px; border: 1px solid #ccc; margin-bottom: 20px;">
          <strong>ğŸ“¢ ê³µì§€ì‚¬í•­:</strong> ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
          <input type="checkbox" id="hideToday"> ì˜¤ëŠ˜ í•˜ë£¨ ì´ ì°½ì„ ë‹¤ì‹œ ë³´ì§€ ì•ŠìŒ
          <button onclick="closeNotice()">ë‹«ê¸°</button>
      </div>
  <% } %>

   --%>
  <c:if test="${showNotice==true}">
      <div id="noticeBox" style="background-color: #fffae6; padding: 15px; border: 1px solid #ccc; margin-bottom: 20px;">
          <strong>ğŸ“¢ ê³µì§€ì‚¬í•­:</strong> ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
          <input type="checkbox" id="hideToday"> ì˜¤ëŠ˜ í•˜ë£¨ ì´ ì°½ì„ ë‹¤ì‹œ ë³´ì§€ ì•ŠìŒ
          <button onclick="closeNotice()">ë‹«ê¸°</button>
      </div>
  </c:if>

  <h2>ë©”ì¸ ì½˜í…ì¸ </h2>
  <p>ì—¬ê¸° ë©”ì¸ í˜ì´ì§€ ë‚´ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>

  </body>
  </html>
  ```

  â€‹