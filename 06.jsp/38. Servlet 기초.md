# 38. Servlet 기초



### 01. servlet 생성

1. File > new > servlet

2. Source 폴더를 확인 후, Java package와 Class name 설정 > Finish

3. `@WebServlet("/서블렛호출이름")`

4. `doGet` :arrow_right: `method="get"`

5. `doPost` :arrow_right: `method="post"`

    

- 예제)

  - getJsp.jsp

    ```jsp
    <%@ page language="java" contentType="text/html; charset=UTF-8"
        pageEncoding="UTF-8"%>
    <!DOCTYPE html>
    <html>
    <head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    </head>
    <body>
    	<h1>Get방식</h1>
    	<form action="GetServlet" method="get">
    		msg <input name="msg">
    		<input type="submit" value="전송">
    	</form>
    	
    	<h1>Post방식</h1>
    	<form action="PostServlet" method="post">
    		msg <input name="msg">
    		<input type="submit" value="전송">
    	</form>
    </body>
    </html>
    ```

  - GetServlet.java

    ```java
    package ch08;

    import java.io.IOException;
    import java.io.PrintWriter;

    import javax.servlet.ServletException;
    import javax.servlet.annotation.WebServlet;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;

    /**
     * Servlet implementation class GetServlet
     */
    @WebServlet("/GetServlet")
    public class GetServlet extends HttpServlet {
    	private static final long serialVersionUID = 1L;
           
        /**
         * @see HttpServlet#HttpServlet()
         */
        public GetServlet() {
            super();
            // TODO Auto-generated constructor stub
        }

    	/**
    	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
    	 */
    	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    		String msg = request.getParameter("msg");
    		response.setContentType("text/html; charset=UTF-8");
    		PrintWriter out = response.getWriter(); 
    		out.println("<html>");
    		out.println("<body>");
    		out.println("<h1>Get Servlet 방식</h1>");
    		out.println("<h2>msg : "+msg + "</h2>");
    		out.println("</body>");
    		out.println("</html>");
    	}

    	/**
    	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
    	 */
    	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    		// TODO Auto-generated method stub
    		doGet(request, response);
    	}
    }
    ```

  - PostServlet.java

    ```java
    package ch08;

    import java.io.IOException;
    import java.io.PrintWriter;

    import javax.servlet.ServletException;
    import javax.servlet.annotation.WebServlet;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;

    /**
     * Servlet implementation class GetServlet
     */
    @WebServlet("/PostServlet")
    public class PostServlet extends HttpServlet {
    	private static final long serialVersionUID = 1L;
           
        /**
         * @see HttpServlet#HttpServlet()
         */
        public PostServlet() {
            super();
            // TODO Auto-generated constructor stub
        }

    	/**
    	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
    	 */
    	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    		// get으로 받을 때
    	}

    	/**
    	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
    	 */
    	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    		// 서버가 클라이언트로부터 받은 요청의 문자 인코딩(msg호출되기 전에)
    		request.setCharacterEncoding("utf-8");
    		
    		String msg = request.getParameter("msg");
    		
    		// HTML 페이지에 한글이 포함된 경우, 클라이언트가 이를 올바르게 보여주기 위한 문자 인코딩
    		response.setContentType("text/html; charset=UTF-8");
    		
    		PrintWriter out = response.getWriter(); 
    		out.println("<html>");
    		
    		// 한글이 깨져서 나온다면 아래의 코드를 추가해도 됨
    		// out.println("<head>");
    		// out.println("<meta charset=\"UTF-8\">");
    		// out.println("<head>");
    		
    		out.println("</head>");
    		out.println("<body>");
    		out.println("<h1>Post Servlet 방식</h1>");
    		out.println("<h2>msg : "+msg + "</h2>");
    		out.println("</body>");
    		out.println("</html>");
    	}
    }
    ```

    ​

### 02. Beans

- 자바빈즈 작성
  1. 정보를 저장하는 변수는 모두 `private`로 선언
  2. `private`로 선언된 변수의 값을 저장하는 메소드생성 (`getter`)
     - 메소드 이름 `setXxx()` 형식
     - `Xxx`는 변수의 이름과 같으며 첫 글자는 대문자
  3. `private`로 선언된 변수의 값을 가져오는 메소드 생성 (`setter`)
     - 메소드 이름 `getXxx()` 형식
     - `Xxx`는 변수의 이름과 같으며 첫 글자는 대문자
  4. `setXxx()` 메소드와 `getXxx()` 메소드를 `public`으로 선언
     - 간접 접근 허용
     - 직접 접근 X



### 03. 데이터베이스

- [MySQL download](https://downloads.mysql.com/archives/community/) 
  - Ver. 5.5.62 (zip이 아닌 **installer 버전을 권장**)
  - zip파일은 설정할 게 많음
  - rc는 Release Candidate의 약자로 출시 후보 버전 또는 프리뷰 릴리즈 버전을 의미하므로 공식 버전이 X (주의)

> 1. 기본 (defualt) 설정으로 진행
> 2. Multiple 선택
>    - transaction 이 없는 버전은 속도는 빠르지만 자동 트랜잭션으로 위험성 있음
> 3. Port Number은 다른 DBMS 사용시, 겹치지 않도록 조심
>    - MariaDB도 MySQL와 똑같이 기본 포트 번호가 3306
> 4. Manual Selected Default Character Set :arrow_right: `utf-8`
> 5. Modify Security Settings :arrow_right: 비밀번호 설정
>    - 다른 OS나 환경에서 실행할 경우 `Enable root from remote machine` 원격 접속 허용을 체크해야 하지만, 요즘에는 보안을 위해 허용하지 않음
> 6. finish



- [워크벤치 다운로드](https://dev.mysql.com/downloads/file/?id=536668)
  - No thanks, just start my download 를 클릭하면 무료 다운로드 가능
  - 설치 후, root 접속 및 설정 비밀번호 입력

```sql
create database mydb default charset utf8 collate utf8_general_ci;

/*
사용자 생성 
@localhost는 로컬에서만 접속가능
identified by : 비밀번호
*/
create user 'hkd'@'localhost' identified by '1234';

/*
 * 는 모든 테이블 권한
*/
grant all privileges on mydb.* to 'hkd'@'localhost';
flush privileges;
```



- `hkd`으로 workbench 추가(`My connection +`)

  - Connection Name 자유
  - Username: `hkd`
  -  Test Connection > 비밀번호 입력 > OK

  ```sql
  use mydb; -- db선택 alter

  /*
  Oracle과 다르게 varchar2가 없고 int를 사용
  */
  create table tblRegister(
  	id varchar(20) primary key,
      pwd varchar(20) not null,
      name varchar(20) not null,
      email varchar(30) not null,
      phone varchar(30) not null
  );

  insert into tblRegister values('hkd','1234','홍길동','hkd@email.com','010-1234-1234');
  -- commit 필요없이 자동commit
  select * from tblRegister;

  update tblRegister set pwd='1111' where id='hkd';
  delete from tblRegister where id='hkd';
  -- delete from tblRegister; 프라이머리 키가 safe updates 로 인해 삭제 방지
  -- 설정>SQL Editer 가장 하단에 체크박스 

  -- 수동 트랜잭션시작
  start transaction; -- 트랜잭션 시작 commit, rollback 가능

  insert into tblRegister values('hkd','1234','홍길동','hkd@email.com','010-1234-1234');
  commit;

  delete from tblRegister where id='hkd';
  select * from tblRegister;
  rollback;
  ```



### 04. JDBC

- [MySQL Connet J download](https://downloads.mysql.com/archives/c-j/)

  - ver 5.1.45 `zip` 파일 다운로드

  - 프로젝트 src/main/webapp/WEB-INF/lib 에 `.jar` 붙여넣기

  - dbcpTest.jsp

    ```java
    <%@page import="java.sql.SQLException"%>
    <%@page import="java.sql.Connection"%>
    <%@page import="java.sql.DriverManager"%>
    <%@ page language="java" contentType="text/html; charset=UTF-8"
        pageEncoding="UTF-8"%>
    <!DOCTYPE html>
    <html>
    <head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    </head>
    <body>
    <%
    	Connection con;
    	
    	try{
    		Class.forName("org.gjt.mm.mysql.Driver").newInstance();
    		con=DriverManager.getConnection("jdbc:mysql://localhost:3306/mydb", "root", "1234");
    		System.out.println("Success");
    	}
    	catch(SQLException ex){ System.out.println("SQLException" + ex);}
    	catch(Exception ex){ System.out.println("Exception:" + ex);}
    %>
    </body>
    </html>
    ```

  - Database Connection Pooling (DBCP)

  ​

### 05. ConnectionPool

- 데이터베이스에 연결하고 질의와 결과를 받아오는 부분에서 많은시간 소요
  - 해당 과정에서 서버에 많은 부하(memory)를 줌 (+동시 접속자)
  - ConnetcionPool을 사용하여 부하를 줄여줌



**Pooling 기법**

- 효율적으로 복수의 사용자에게 서비스하기위해 미리 데이터베이스 연결을 위한 객체들을 생성
-  Connection 객체의 **재사용**(Connection 객체를 미리 생성 빌려주고 반납하는 개념)
  - 데이터베이스 연결 객체를 매번 생성, 사용, 해제 하지않고 처음 만들어둔 데이터베이스 연결 객체를 계속 사용
- 사용자에게 필요한 응답을 주는데 걸리는 시간을 단축하고 시스템 부하를 줄임



