# 44. Spring security

- spring/**security-context.xml**

  ```XML
  <?xml version="1.0" encoding="UTF-8"?>
  <beans xmlns="http://www.springframework.org/schema/beans"
  	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  	xmlns:security="http://www.springframework.org/schema/security"
  	xsi:schemaLocation="
  		http://www.springframework.org/schema/beans 
  		http://www.springframework.org/schema/beans/spring-beans.xsd
  		http://www.springframework.org/schema/security 
  		http://www.springframework.org/schema/security/spring-security.xsd">

  	<!-- 기본 URL 접근 정책 -->
  	<security:http>
  	</security:http>

  	<!-- 간단한 사용자 인증 설정 -->
  	<security:authentication-manager>
  	</security:authentication-manager>

  </beans>

  ```

  - root-context.xml과 동일 폴더에 생성

- `/login` 으로 접속하면 로그인 화면이 출력 됨

  - member/admin 으로 사용자 인증을 사용할 수 있음

  :star::star::star: <u>ERD생성시 Table에 security role도 필요함</u>



#### principal

- Spring security가 로그인 후 사용자의 정보를 저장하는 객체



> **Spring Security 는**
>
> - spring security는 id를 username이라고 함 (pw는 password)
> - 기본적으로 username, password, authorities를 처리
> - 처음에 로그인 페이지에서 로그인을 하면 index("/")페이지로 이동
> - 특정 주소에 접근하려고 시도하다가 로그인 페이지로 redirect된 후 로그인을 하면 접근을 시도한 주소로 이동
> - 기본적으로 post, put(patch), delete방식에서는 csrf token을 사용



#### csrf token

- csrf 공격을 방어하기 위한 토큰값. 
- 서버에서 임의의 값을 생성해서 front end로 보냄
  - csrf token값이 일치해야 처리됨



> **csrf token 구현법**
>
> 예) 로그인 처리
>
> 1. 서버주소(/login)를 요청(접근)하면 컨트롤러에서 csrf token 생성. session attribute에 저장
> 2. csrf token을 hidden태그 형태로 만들어서 front end로 전송
> 3. 로그인 버튼을 누르면 front end에서 전달되 csrf token 값과 1번에서 저장한 session attribute값이 같은지 확인해서 같을 때만 처리







